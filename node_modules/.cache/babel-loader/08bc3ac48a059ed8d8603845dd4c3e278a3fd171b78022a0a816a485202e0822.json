{"ast":null,"code":"import { BaseError } from '../errors/base.js';\nimport { HttpRequestError } from '../errors/request.js';\nimport { ChainDisconnectedError, InternalRpcError, InvalidInputRpcError, InvalidParamsRpcError, InvalidRequestRpcError, JsonRpcVersionUnsupportedError, LimitExceededRpcError, MethodNotFoundRpcError, MethodNotSupportedRpcError, ParseRpcError, ProviderDisconnectedError, ResourceNotFoundRpcError, ResourceUnavailableRpcError, SwitchChainError, TransactionRejectedRpcError, UnauthorizedProviderError, UnknownRpcError, UnsupportedProviderMethodError, UserRejectedRequestError } from '../errors/rpc.js';\nimport { withRetry } from './promise/withRetry.js';\nexport const isDeterministicError = error => {\n  if ('code' in error) return error.code !== -1 && error.code !== -32004 && error.code !== -32005 && error.code !== -32042 && error.code !== -32603;\n  if (error instanceof HttpRequestError && error.status) return error.status !== 403 && error.status !== 408 && error.status !== 413 && error.status !== 429 && error.status !== 500 && error.status !== 502 && error.status !== 503 && error.status !== 504;\n  return false;\n};\nexport function buildRequest(request) {\n  let {\n    retryDelay = 150,\n    retryCount = 3\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return async args => withRetry(async () => {\n    try {\n      return await request(args);\n    } catch (err_) {\n      const err = err_;\n      switch (err.code) {\n        // -32700\n        case ParseRpcError.code:\n          throw new ParseRpcError(err);\n        // -32600\n        case InvalidRequestRpcError.code:\n          throw new InvalidRequestRpcError(err);\n        // -32601\n        case MethodNotFoundRpcError.code:\n          throw new MethodNotFoundRpcError(err);\n        // -32602\n        case InvalidParamsRpcError.code:\n          throw new InvalidParamsRpcError(err);\n        // -32603\n        case InternalRpcError.code:\n          throw new InternalRpcError(err);\n        // -32000\n        case InvalidInputRpcError.code:\n          throw new InvalidInputRpcError(err);\n        // -32001\n        case ResourceNotFoundRpcError.code:\n          throw new ResourceNotFoundRpcError(err);\n        // -32002\n        case ResourceUnavailableRpcError.code:\n          throw new ResourceUnavailableRpcError(err);\n        // -32003\n        case TransactionRejectedRpcError.code:\n          throw new TransactionRejectedRpcError(err);\n        // -32004\n        case MethodNotSupportedRpcError.code:\n          throw new MethodNotSupportedRpcError(err);\n        // -32005\n        case LimitExceededRpcError.code:\n          throw new LimitExceededRpcError(err);\n        // -32006\n        case JsonRpcVersionUnsupportedError.code:\n          throw new JsonRpcVersionUnsupportedError(err);\n        // 4001\n        case UserRejectedRequestError.code:\n          throw new UserRejectedRequestError(err);\n        // 4100\n        case UnauthorizedProviderError.code:\n          throw new UnauthorizedProviderError(err);\n        // 4200\n        case UnsupportedProviderMethodError.code:\n          throw new UnsupportedProviderMethodError(err);\n        // 4900\n        case ProviderDisconnectedError.code:\n          throw new ProviderDisconnectedError(err);\n        // 4901\n        case ChainDisconnectedError.code:\n          throw new ChainDisconnectedError(err);\n        // 4902\n        case SwitchChainError.code:\n          throw new SwitchChainError(err);\n        // CAIP-25: User Rejected Error\n        // https://docs.walletconnect.com/2.0/specs/clients/sign/error-codes#rejected-caip-25\n        case 5000:\n          throw new UserRejectedRequestError(err);\n        default:\n          if (err_ instanceof BaseError) throw err_;\n          throw new UnknownRpcError(err);\n      }\n    }\n  }, {\n    delay: _ref => {\n      let {\n        count,\n        error\n      } = _ref;\n      // If we find a Retry-After header, let's retry after the given time.\n      if (error && error instanceof HttpRequestError) {\n        var _error$headers;\n        const retryAfter = error === null || error === void 0 || (_error$headers = error.headers) === null || _error$headers === void 0 ? void 0 : _error$headers.get('Retry-After');\n        if (retryAfter !== null && retryAfter !== void 0 && retryAfter.match(/\\d/)) return parseInt(retryAfter) * 1000;\n      }\n      // Otherwise, let's retry with an exponential backoff.\n      return ~~(1 << count) * retryDelay;\n    },\n    retryCount,\n    shouldRetry: _ref2 => {\n      let {\n        error\n      } = _ref2;\n      return !isDeterministicError(error);\n    }\n  });\n}","map":{"version":3,"names":["BaseError","HttpRequestError","ChainDisconnectedError","InternalRpcError","InvalidInputRpcError","InvalidParamsRpcError","InvalidRequestRpcError","JsonRpcVersionUnsupportedError","LimitExceededRpcError","MethodNotFoundRpcError","MethodNotSupportedRpcError","ParseRpcError","ProviderDisconnectedError","ResourceNotFoundRpcError","ResourceUnavailableRpcError","SwitchChainError","TransactionRejectedRpcError","UnauthorizedProviderError","UnknownRpcError","UnsupportedProviderMethodError","UserRejectedRequestError","withRetry","isDeterministicError","error","code","status","buildRequest","request","retryDelay","retryCount","arguments","length","undefined","args","err_","err","delay","_ref","count","_error$headers","retryAfter","headers","get","match","parseInt","shouldRetry","_ref2"],"sources":["/Users/kanaiyuuta/Downloads/test-yuuta-main/node_modules/viem/utils/buildRequest.ts"],"sourcesContent":["import { BaseError } from '../errors/base.js'\nimport { HttpRequestError } from '../errors/request.js'\nimport {\n  ChainDisconnectedError,\n  InternalRpcError,\n  InvalidInputRpcError,\n  InvalidParamsRpcError,\n  InvalidRequestRpcError,\n  JsonRpcVersionUnsupportedError,\n  LimitExceededRpcError,\n  MethodNotFoundRpcError,\n  MethodNotSupportedRpcError,\n  ParseRpcError,\n  ProviderDisconnectedError,\n  type ProviderRpcErrorCode,\n  ResourceNotFoundRpcError,\n  ResourceUnavailableRpcError,\n  type RpcError,\n  type RpcErrorCode,\n  SwitchChainError,\n  TransactionRejectedRpcError,\n  UnauthorizedProviderError,\n  UnknownRpcError,\n  UnsupportedProviderMethodError,\n  UserRejectedRequestError,\n} from '../errors/rpc.js'\n\nimport { withRetry } from './promise/withRetry.js'\n\nexport const isDeterministicError = (error: Error) => {\n  if ('code' in error)\n    return (\n      error.code !== -1 &&\n      error.code !== -32004 &&\n      error.code !== -32005 &&\n      error.code !== -32042 &&\n      error.code !== -32603\n    )\n  if (error instanceof HttpRequestError && error.status)\n    return (\n      error.status !== 403 &&\n      error.status !== 408 &&\n      error.status !== 413 &&\n      error.status !== 429 &&\n      error.status !== 500 &&\n      error.status !== 502 &&\n      error.status !== 503 &&\n      error.status !== 504\n    )\n  return false\n}\n\nexport function buildRequest<TRequest extends (args: any) => Promise<any>>(\n  request: TRequest,\n  {\n    retryDelay = 150,\n    retryCount = 3,\n  }: {\n    // The base delay (in ms) between retries.\n    retryDelay?: number\n    // The max number of times to retry.\n    retryCount?: number\n  } = {},\n) {\n  return (async (args: any) =>\n    withRetry(\n      async () => {\n        try {\n          return await request(args)\n        } catch (err_) {\n          const err = err_ as unknown as RpcError<\n            RpcErrorCode | ProviderRpcErrorCode\n          >\n          switch (err.code) {\n            // -32700\n            case ParseRpcError.code:\n              throw new ParseRpcError(err)\n            // -32600\n            case InvalidRequestRpcError.code:\n              throw new InvalidRequestRpcError(err)\n            // -32601\n            case MethodNotFoundRpcError.code:\n              throw new MethodNotFoundRpcError(err)\n            // -32602\n            case InvalidParamsRpcError.code:\n              throw new InvalidParamsRpcError(err)\n            // -32603\n            case InternalRpcError.code:\n              throw new InternalRpcError(err)\n            // -32000\n            case InvalidInputRpcError.code:\n              throw new InvalidInputRpcError(err)\n            // -32001\n            case ResourceNotFoundRpcError.code:\n              throw new ResourceNotFoundRpcError(err)\n            // -32002\n            case ResourceUnavailableRpcError.code:\n              throw new ResourceUnavailableRpcError(err)\n            // -32003\n            case TransactionRejectedRpcError.code:\n              throw new TransactionRejectedRpcError(err)\n            // -32004\n            case MethodNotSupportedRpcError.code:\n              throw new MethodNotSupportedRpcError(err)\n            // -32005\n            case LimitExceededRpcError.code:\n              throw new LimitExceededRpcError(err)\n            // -32006\n            case JsonRpcVersionUnsupportedError.code:\n              throw new JsonRpcVersionUnsupportedError(err)\n            // 4001\n            case UserRejectedRequestError.code:\n              throw new UserRejectedRequestError(err)\n            // 4100\n            case UnauthorizedProviderError.code:\n              throw new UnauthorizedProviderError(err)\n            // 4200\n            case UnsupportedProviderMethodError.code:\n              throw new UnsupportedProviderMethodError(err)\n            // 4900\n            case ProviderDisconnectedError.code:\n              throw new ProviderDisconnectedError(err)\n            // 4901\n            case ChainDisconnectedError.code:\n              throw new ChainDisconnectedError(err)\n            // 4902\n            case SwitchChainError.code:\n              throw new SwitchChainError(err)\n            // CAIP-25: User Rejected Error\n            // https://docs.walletconnect.com/2.0/specs/clients/sign/error-codes#rejected-caip-25\n            case 5000:\n              throw new UserRejectedRequestError(err)\n            default:\n              if (err_ instanceof BaseError) throw err_\n              throw new UnknownRpcError(err as Error)\n          }\n        }\n      },\n      {\n        delay: ({ count, error }) => {\n          // If we find a Retry-After header, let's retry after the given time.\n          if (error && error instanceof HttpRequestError) {\n            const retryAfter = error?.headers?.get('Retry-After')\n            if (retryAfter?.match(/\\d/)) return parseInt(retryAfter) * 1000\n          }\n\n          // Otherwise, let's retry with an exponential backoff.\n          return ~~(1 << count) * retryDelay\n        },\n        retryCount,\n        shouldRetry: ({ error }) => !isDeterministicError(error),\n      },\n    )) as TRequest\n}\n"],"mappings":"AAAA,SAASA,SAAS,QAAQ,mBAAmB;AAC7C,SAASC,gBAAgB,QAAQ,sBAAsB;AACvD,SACEC,sBAAsB,EACtBC,gBAAgB,EAChBC,oBAAoB,EACpBC,qBAAqB,EACrBC,sBAAsB,EACtBC,8BAA8B,EAC9BC,qBAAqB,EACrBC,sBAAsB,EACtBC,0BAA0B,EAC1BC,aAAa,EACbC,yBAAyB,EAEzBC,wBAAwB,EACxBC,2BAA2B,EAG3BC,gBAAgB,EAChBC,2BAA2B,EAC3BC,yBAAyB,EACzBC,eAAe,EACfC,8BAA8B,EAC9BC,wBAAwB,QACnB,kBAAkB;AAEzB,SAASC,SAAS,QAAQ,wBAAwB;AAElD,OAAO,MAAMC,oBAAoB,GAAIC,KAAY,IAAI;EACnD,IAAI,MAAM,IAAIA,KAAK,EACjB,OACEA,KAAK,CAACC,IAAI,KAAK,CAAC,CAAC,IACjBD,KAAK,CAACC,IAAI,KAAK,CAAC,KAAK,IACrBD,KAAK,CAACC,IAAI,KAAK,CAAC,KAAK,IACrBD,KAAK,CAACC,IAAI,KAAK,CAAC,KAAK,IACrBD,KAAK,CAACC,IAAI,KAAK,CAAC,KAAK;EAEzB,IAAID,KAAK,YAAYtB,gBAAgB,IAAIsB,KAAK,CAACE,MAAM,EACnD,OACEF,KAAK,CAACE,MAAM,KAAK,GAAG,IACpBF,KAAK,CAACE,MAAM,KAAK,GAAG,IACpBF,KAAK,CAACE,MAAM,KAAK,GAAG,IACpBF,KAAK,CAACE,MAAM,KAAK,GAAG,IACpBF,KAAK,CAACE,MAAM,KAAK,GAAG,IACpBF,KAAK,CAACE,MAAM,KAAK,GAAG,IACpBF,KAAK,CAACE,MAAM,KAAK,GAAG,IACpBF,KAAK,CAACE,MAAM,KAAK,GAAG;EAExB,OAAO,KAAK;AACd,CAAC;AAED,OAAM,SAAUC,YAAYA,CAC1BC,OAAiB,EASX;EAAA,IARN;IACEC,UAAU,GAAG,GAAG;IAChBC,UAAU,GAAG;EAAC,IAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAMZ,EAAE;EAEN,OAAQ,MAAOG,IAAS,IACtBZ,SAAS,CACP,YAAW;IACT,IAAI;MACF,OAAO,MAAMM,OAAO,CAACM,IAAI,CAAC;KAC3B,CAAC,OAAOC,IAAI,EAAE;MACb,MAAMC,GAAG,GAAGD,IAEX;MACD,QAAQC,GAAG,CAACX,IAAI;QACd;QACA,KAAKb,aAAa,CAACa,IAAI;UACrB,MAAM,IAAIb,aAAa,CAACwB,GAAG,CAAC;QAC9B;QACA,KAAK7B,sBAAsB,CAACkB,IAAI;UAC9B,MAAM,IAAIlB,sBAAsB,CAAC6B,GAAG,CAAC;QACvC;QACA,KAAK1B,sBAAsB,CAACe,IAAI;UAC9B,MAAM,IAAIf,sBAAsB,CAAC0B,GAAG,CAAC;QACvC;QACA,KAAK9B,qBAAqB,CAACmB,IAAI;UAC7B,MAAM,IAAInB,qBAAqB,CAAC8B,GAAG,CAAC;QACtC;QACA,KAAKhC,gBAAgB,CAACqB,IAAI;UACxB,MAAM,IAAIrB,gBAAgB,CAACgC,GAAG,CAAC;QACjC;QACA,KAAK/B,oBAAoB,CAACoB,IAAI;UAC5B,MAAM,IAAIpB,oBAAoB,CAAC+B,GAAG,CAAC;QACrC;QACA,KAAKtB,wBAAwB,CAACW,IAAI;UAChC,MAAM,IAAIX,wBAAwB,CAACsB,GAAG,CAAC;QACzC;QACA,KAAKrB,2BAA2B,CAACU,IAAI;UACnC,MAAM,IAAIV,2BAA2B,CAACqB,GAAG,CAAC;QAC5C;QACA,KAAKnB,2BAA2B,CAACQ,IAAI;UACnC,MAAM,IAAIR,2BAA2B,CAACmB,GAAG,CAAC;QAC5C;QACA,KAAKzB,0BAA0B,CAACc,IAAI;UAClC,MAAM,IAAId,0BAA0B,CAACyB,GAAG,CAAC;QAC3C;QACA,KAAK3B,qBAAqB,CAACgB,IAAI;UAC7B,MAAM,IAAIhB,qBAAqB,CAAC2B,GAAG,CAAC;QACtC;QACA,KAAK5B,8BAA8B,CAACiB,IAAI;UACtC,MAAM,IAAIjB,8BAA8B,CAAC4B,GAAG,CAAC;QAC/C;QACA,KAAKf,wBAAwB,CAACI,IAAI;UAChC,MAAM,IAAIJ,wBAAwB,CAACe,GAAG,CAAC;QACzC;QACA,KAAKlB,yBAAyB,CAACO,IAAI;UACjC,MAAM,IAAIP,yBAAyB,CAACkB,GAAG,CAAC;QAC1C;QACA,KAAKhB,8BAA8B,CAACK,IAAI;UACtC,MAAM,IAAIL,8BAA8B,CAACgB,GAAG,CAAC;QAC/C;QACA,KAAKvB,yBAAyB,CAACY,IAAI;UACjC,MAAM,IAAIZ,yBAAyB,CAACuB,GAAG,CAAC;QAC1C;QACA,KAAKjC,sBAAsB,CAACsB,IAAI;UAC9B,MAAM,IAAItB,sBAAsB,CAACiC,GAAG,CAAC;QACvC;QACA,KAAKpB,gBAAgB,CAACS,IAAI;UACxB,MAAM,IAAIT,gBAAgB,CAACoB,GAAG,CAAC;QACjC;QACA;QACA,KAAK,IAAI;UACP,MAAM,IAAIf,wBAAwB,CAACe,GAAG,CAAC;QACzC;UACE,IAAID,IAAI,YAAYlC,SAAS,EAAE,MAAMkC,IAAI;UACzC,MAAM,IAAIhB,eAAe,CAACiB,GAAY,CAAC;;;EAG/C,CAAC,EACD;IACEC,KAAK,EAAEC,IAAA,IAAqB;MAAA,IAApB;QAAEC,KAAK;QAAEf;MAAK,CAAE,GAAAc,IAAA;MACtB;MACA,IAAId,KAAK,IAAIA,KAAK,YAAYtB,gBAAgB,EAAE;QAAA,IAAAsC,cAAA;QAC9C,MAAMC,UAAU,GAAGjB,KAAK,aAALA,KAAK,gBAAAgB,cAAA,GAALhB,KAAK,CAAEkB,OAAO,cAAAF,cAAA,uBAAdA,cAAA,CAAgBG,GAAG,CAAC,aAAa,CAAC;QACrD,IAAIF,UAAU,aAAVA,UAAU,eAAVA,UAAU,CAAEG,KAAK,CAAC,IAAI,CAAC,EAAE,OAAOC,QAAQ,CAACJ,UAAU,CAAC,GAAG,IAAI;;MAGjE;MACA,OAAO,CAAC,EAAE,CAAC,IAAIF,KAAK,CAAC,GAAGV,UAAU;IACpC,CAAC;IACDC,UAAU;IACVgB,WAAW,EAAEC,KAAA;MAAA,IAAC;QAAEvB;MAAK,CAAE,GAAAuB,KAAA;MAAA,OAAK,CAACxB,oBAAoB,CAACC,KAAK,CAAC;IAAA;GACzD,CACF;AACL"},"metadata":{},"sourceType":"module","externalDependencies":[]}